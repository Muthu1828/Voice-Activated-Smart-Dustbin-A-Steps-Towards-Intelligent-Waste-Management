import serial
import speech_recognition as sr
import pyttsx3
import time

# Initialize serial communication with Arduino
arduino_port = 'COM3'  # Replace 'COM3' with your Arduino port
baud_rate = 9600
arduino = serial.Serial(arduino_port, baud_rate, timeout=1)

# Initialize text-to-speech engine
engine = pyttsx3.init()
engine.setProperty('rate', 150)  # Speed of speech

# Initialize recognizer
recognizer = sr.Recognizer()

def speak(text):
    engine.say(text)
    engine.runAndWait()

def listen_command():
    with sr.Microphone() as source:
        print("Listening for command...")
        recognizer.adjust_for_ambient_noise(source)
        audio = recognizer.listen(source, timeout=5)
    try:
        command = recognizer.recognize_google(audio).lower()
        print("You said:", command)
        return command
    except sr.UnknownValueError:
        speak("Sorry, I didn't catch that.")
        return ""
    except sr.RequestError:
        speak("Sorry, there was an issue with the recognition service.")
        return ""

def control_dustbin(command):
    if "open" in command:
        arduino.write(b'open\n')
        speak("Dustbin is opening.")
    elif "close" in command:
        arduino.write(b'close\n')
        speak("Dustbin is closing.")
    else:
        speak("Please say open or close.")

try:
    while True:
        command = listen_command()
        if command:
            control_dustbin(command)
        time.sleep(2)  # Delay between commands
except KeyboardInterrupt:
    print("Program stopped.")
finally:
    arduino.close()